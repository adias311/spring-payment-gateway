<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Pembayaran BNI Virtual Account</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }
        .container {
            max-width: 420px;
            margin: auto;
            background: #fff;
            padding: 24px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,.1);
        }
        h2 {
            text-align: center;
            color: #0047ab;
        }
        .amount {
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            margin: 16px 0;
        }
        .va-box {
            background: #eef3ff;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 16px;
        }
        .va-number {
            font-size: 20px;
            font-weight: bold;
            letter-spacing: 1px;
        }
        .btn-copy {
            margin-top: 8px;
            padding: 8px 12px;
            background: #0047ab;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .info {
            font-size: 14px;
            color: #555;
            margin-top: 12px;
        }
        .countdown {
            text-align: center;
            margin-top: 12px;
            color: #d32f2f;
            font-weight: bold;
        }
        ol {
            margin-top: 16px;
            padding-left: 18px;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Pembayaran BNI Virtual Account</h2>

    <div class="amount">
        Rp <span id="amount"></span>
    </div>

    <div class="va-box">
        <div>Nomor Virtual Account</div>
        <div class="va-number" id="vaNumber"></div>
        <button class="btn-copy" onclick="copyVA()">Salin VA</button>
    </div>

    <div class="countdown">
        Berlaku sampai: <span id="expiredAt"></span><br>
        Sisa waktu: <span id="timer"></span>
    </div>

    <div class="info">
        <strong>Cara Pembayaran:</strong>
        <ol>
            <li>Buka aplikasi BNI Mobile Banking / ATM BNI</li>
            <li>Pilih <b>Transfer</b> â†’ <b>Virtual Account Billing</b></li>
            <li>Masukkan nomor Virtual Account di atas</li>
            <li>Pastikan nominal sesuai</li>
            <li>Selesaikan pembayaran</li>
        </ol>
    </div>
</div>

<script>
    // ===== DATA DARI BACKEND =====
    const params = new URLSearchParams(window.location.search);

    const paymentResponse = {
        amount: Number(params.get("amount")),
        vaNumber: params.get("vaNumber"),
        expiresAt: params.get("expiresAt")
    };

    console.log("VA Payment Data:", paymentResponse);

    // Format rupiah
    function formatRupiah(amount) {
        return amount.toLocaleString("id-ID");
    }

    document.getElementById("amount").innerText =
        formatRupiah(paymentResponse.amount);

    document.getElementById("vaNumber").innerText =
        paymentResponse.vaNumber;

    const expiredDate = new Date(paymentResponse.expiresAt);

    // Format: Sabtu, 10 Januari 2026, 19:08
    const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric', 
        hour: '2-digit', 
        minute: '2-digit',
        hour12: false
    };

    document.getElementById("expiredAt").innerText = 
        expiredDate.toLocaleString("id-ID", options);


    // Countdown timer
    function startCountdown() {
        const timerEl = document.getElementById("timer");

        setInterval(() => {
            const now = new Date();
            const diff = expiredDate - now;

            if (diff <= 0) {
                timerEl.innerText = "Expired";
                return;
            }

            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff / (1000 * 60)) % 60);
            const seconds = Math.floor((diff / 1000) % 60);

            timerEl.innerText =
                `${hours}j ${minutes}m ${seconds}d`;
        }, 1000);
    }

    startCountdown();

    // Copy VA
    function copyVA() {
        navigator.clipboard.writeText(paymentResponse.vaNumber);
        alert("Nomor VA berhasil disalin");
    }
</script>

</body>
</html>
